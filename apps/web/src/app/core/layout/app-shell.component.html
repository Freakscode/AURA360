<mat-sidenav-container class="app-sidenav-container" autosize>
  <!-- Side Navigation -->
  <mat-sidenav
    #sidenav
    mode="side"
    [opened]="isSideNavOpen()"
    class="app-sidenav"
    [fixedInViewport]="false"
  >
    <div class="sidenav-header">
      <div class="brand-logo-container">
        <img src="aura/LOGOFPOSITIVOAura.png" alt="AURA360" class="brand-logo" />
      </div>
    </div>

    <mat-nav-list class="sidenav-list">
      @if (menuItems().length > 0) {
        <h3 mat-subheader class="sidenav-subheader">Navegación</h3>
        @for (item of menuItems(); track item.route) {
          <a
            mat-list-item
            [routerLink]="item.route"
            routerLinkActive="active-link"
            [routerLinkActiveOptions]="{ exact: item.exactMatch || false }"
            [class.premium-item]="item.isPremium"
          >
            <mat-icon matListItemIcon>{{ item.icon || 'circle' }}</mat-icon>
            <span matListItemTitle>
              {{ item.label }}
              @if (item.badge) {
                <span class="menu-badge">{{ item.badge }}</span>
              }
            </span>
            @if (item.isPremium) {
               <mat-icon matListItemMeta class="premium-icon" matTooltip="Premium Feature">star</mat-icon>
            }
          </a>
        }
      } @else {
        <div class="empty-state">
          <p>No hay opciones disponibles</p>
        </div>
      }

      <mat-divider class="nav-divider"></mat-divider>

      <a mat-list-item href="#">
        <mat-icon matListItemIcon>help_outline</mat-icon>
        <span matListItemTitle>Ayuda y Soporte</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Main Content Area -->
  <mat-sidenav-content class="app-sidenav-content">
    <!-- Toolbar / Header -->
    <mat-toolbar color="primary" class="app-toolbar">
      <button
        mat-icon-button
        (click)="toggleSideNav()"
        aria-label="Toggle navigation"
      >
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Right Actions -->
      <div class="toolbar-actions">
        <!-- Context Switcher (if present) -->
        @if (hasContexts()) {
          <div class="context-wrapper">
            <app-context-switcher />
          </div>
        }

        <!-- Vertical Divider -->
        <div class="toolbar-divider"></div>

        <!-- Notifications -->
        <button mat-icon-button class="notifications-btn" aria-label="Notificaciones">
          <mat-icon [matBadge]="notificationsCount()" matBadgeColor="warn" [matBadgeHidden]="notificationsCount() === 0">
            notifications_none
          </mat-icon>
        </button>

        <!-- User Menu (Chip Style) -->
        <div
          class="user-chip-trigger"
          [matMenuTriggerFor]="userMenu"
          matRipple
        >
          <img 
            class="user-avatar" 
            [src]="'https://ui-avatars.com/api/?name=' + userName() + '&background=random&color=fff'" 
            [alt]="userName()"
          />
          <div class="user-info">
             <span class="user-name">{{ userName() }}</span>
             <span class="user-role-label">{{ userRole() }}</span>
          </div>
          <mat-icon class="user-chevron">expand_more</mat-icon>
        </div>

        <mat-menu #userMenu="matMenu" xPosition="before" class="user-menu-panel">
          <button mat-menu-item (click)="navigateToProfile()">
            <mat-icon>person</mat-icon>
            <span>Mi Perfil</span>
          </button>
          <button mat-menu-item (click)="navigateToSettings()">
            <mat-icon>settings</mat-icon>
            <span>Configuración</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon color="warn">logout</mat-icon>
            <span>Cerrar Sesión</span>
          </button>
        </mat-menu>
      </div>
    </mat-toolbar>

    <!-- Router Outlet -->
    <main class="main-content-wrapper">
      <router-outlet />
    </main>

  </mat-sidenav-content>
</mat-sidenav-container>
